{% extends 'base.html' %}

{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Inbox</h1>

  {% if conversations %}
    <div class="list-group">
      {% for item in conversations %}
        {% with conv=item.conversation last=item.last_message other=item.other unread=item.unread %}
          <a href="{% url 'conversation_detail' conv.pk %}" class="list-group-item list-group-item-action d-flex align-items-start">
            <div class="me-3">
              <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center" style="width:48px;height:48px;font-weight:600;">
                {{ other.user.username|slice:":1"|upper }}
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <div>
                  <strong>
                    {% if other %}
                          Conversation with {{ other.user.get_full_name|default:other.user.username }}
                        {% else %}
                          Conversation
                        {% endif %}
                  </strong>
                </div>
                <small class="text-muted">{% if last %}{{ last.sent_at|date:"M d, H:i" }}{% endif %}</small>
              </div>
              <div class="text-muted small mt-1">
                {% if last %}
                  <span class="me-2"><strong>{{ last.sender.user.username }}</strong></span>
                  {{ last.body|truncatechars:80 }}
                {% else %}
                  No messages yet.
                {% endif %}
              </div>
            </div>
            <div class="ms-3 text-end">
              {% if unread and unread > 0 %}
                <span class="badge bg-danger">{{ unread }}</span>
              {% endif %}
            </div>
          </a>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <h5 class="mb-0">No conversations yet</h5>
        <p class="text-muted">Start by messaging a recruiter or candidate from their profile page.</p>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
